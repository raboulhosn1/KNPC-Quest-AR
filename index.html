<!DOCTYPE html>
<html>
<head>
    <title>KNPC Quest AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/geolib@3.3.1/lib/index.min.js"></script>
    <style>
        body {
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <h2 style="position: absolute; top: 10px; left: 10px; background: black; color: white; padding: 5px; z-index: 1000;">GPS Status: <span id="gpsStatus">Waiting...</span></h2>
    <button style="position: absolute; top: 50px; left: 10px; z-index: 1000;" onclick="updateGPS()">Update GPS</button>
    
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>
            <a-asset-item id="knpcBooth" src="./knpc_booth.glb"></a-asset-item>
            <a-asset-item id="stage" src="./stage.glb"></a-asset-item>
            <a-asset-item id="knpcLogo" src="./knpc_logo.glb"></a-asset-item>
            <a-asset-item id="glassBoat" src="./glass_boat.glb"></a-asset-item>
            <a-asset-item id="kuwaitTowers" src="./kuwait_towers.glb"></a-asset-item>
            <a-asset-item id="redBarrel" src="./red_barrel.glb"></a-asset-item>
            <a-asset-item id="knpcWorker" src="./knpc_worker.glb"></a-asset-item>
        </a-assets>

        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        function updateGPS() {
            if (!navigator.geolocation) {
                document.getElementById("gpsStatus").innerText = "GPS Error: Geolocation is not supported by this browser.";
                console.error("GPS Error: Geolocation is not supported by this browser.");
                return;
            }
            
            navigator.permissions.query({ name: "geolocation" }).then(function(result) {
                if (result.state === "denied") {
                    document.getElementById("gpsStatus").innerText = "GPS Error: Location access is blocked. Enable permissions in browser settings.";
                    console.error("GPS Error: Location access is blocked.");
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(function(position) {
                    document.getElementById("gpsStatus").innerText = "GPS Active: " + position.coords.latitude + ", " + position.coords.longitude;
                    console.log("GPS Position Updated: ", position.coords.latitude, position.coords.longitude);
                }, function(error) {
                    let errorMsg = "GPS Error: " + (error.message || "Unknown error");
                    document.getElementById("gpsStatus").innerText = errorMsg;
                    console.error(errorMsg);
                }, {
                    enableHighAccuracy: true, 
                    timeout: 10000,
                    maximumAge: 0
                });
            });
        }
        
        // Automatically update GPS on load
        updateGPS();
    </script>
</body>
</html>

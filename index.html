<!DOCTYPE html>
<html>
<head>
    <title>KNPC Quest AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/geolib@3.3.1/lib/index.min.js"></script>
    <style>
        body {
            -webkit-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <h2 style="position: absolute; top: 10px; left: 10px; background: black; color: white; padding: 5px; z-index: 1000;">GPS Status: <span id="gpsStatus">Waiting...</span></h2>
    <button style="position: absolute; top: 50px; left: 10px; z-index: 1000;" onclick="updateGPS()">Update GPS</button>
    
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>
            <a-asset-item id="knpcBooth" src="./knpc_booth.glb"></a-asset-item>
            <a-asset-item id="stage" src="./stage.glb"></a-asset-item>
            <a-asset-item id="knpcLogo" src="./knpc_logo.glb"></a-asset-item>
            <a-asset-item id="glassBoat" src="./glass_boat.glb"></a-asset-item>
            <a-asset-item id="kuwaitTowers" src="./kuwait_towers.glb"></a-asset-item>
            <a-asset-item id="redBarrel" src="./red_barrel.glb"></a-asset-item>
            <a-asset-item id="knpcWorker" src="./knpc_worker.glb"></a-asset-item>
        </a-assets>

        <!-- GPS Entities for AR Placement -->
        <a-entity gps-entity-place="latitude: 29.38833290080186; longitude: 48.003490055566495" 
                  gltf-model="#knpcBooth" scale="1 1 1"></a-entity>

        <a-entity gps-entity-place="latitude: 29.388693957183015; longitude: 48.003310431211574" 
                  gltf-model="#stage" scale="1 1 1"></a-entity>
        
        <a-entity gps-entity-place="latitude: 29.388693957183015; longitude: 48.003310431211574" 
                  gltf-model="#knpcLogo" position="0 3 0" scale="1 1 1"></a-entity>

        <a-entity gps-entity-place="latitude: 29.388453358501053; longitude: 48.003089910222435" 
                  gltf-model="#glassBoat" scale="1 1 1"></a-entity>

        <a-entity gps-entity-place="latitude: 29.389590483399587; longitude: 48.0032380262504" 
                  id="finalStation" gltf-model="#kuwaitTowers" scale="1 1 1"></a-entity>

        <a-entity gps-entity-place="latitude: 29.38833290080186; longitude: 48.003490055566495" 
                  id="redBarrel" gltf-model="#redBarrel" scale="1 1 1"></a-entity>

        <!-- KNPC Worker Roaming at Kuwait Towers -->
        <a-entity id="knpcWorker" gps-entity-place="latitude: 29.389590483399587; longitude: 48.0032380262504"
                  gltf-model="#knpcWorker" scale="1 1 1"
                  animation="property: position; to: 2 0 2; dir: alternate; loop: true; dur: 5000">
        </a-entity>

        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        function updateGPS() {
            navigator.geolocation.getCurrentPosition(function(position) {
                document.getElementById("gpsStatus").innerText = "GPS Active: " + position.coords.latitude + ", " + position.coords.longitude;
                console.log("GPS Position Updated: ", position.coords.latitude, position.coords.longitude);
            }, function(error) {
                document.getElementById("gpsStatus").innerText = "GPS Error: " + error.message;
                console.error("GPS Error: ", error.message);
            }, {
                enableHighAccuracy: true, 
                maximumAge: 0
            });
        }
        
        // Automatically update GPS on load
        updateGPS();
    </script>
</body>
</html>
